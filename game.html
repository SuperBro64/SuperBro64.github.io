<!DOCTYPE html>

<html>
    <head>
        <style>
            body
            {
                background: repeating-linear-gradient(90deg, midnightblue 0%, royalblue 50%, midnightblue 100%);
            }
            h1 { font-family: monospace; text-decoration: underline; color: white; }
            h2 { font-family: monospace; text-decoration: underline; color: white; }
            h3 { font-family: monospace; text-decoration: underline; color: white; }
            p  { font-family: monospace; font-size: large; color: white; }
            a:link, a:visited
            {
                background-color: crimson; color: white; display: inline-block;
                font-family: monospace; text-decoration: none; text-align: center;
                padding: 15px 25px; border: 3px solid black;
            }
            a:hover, a:active { background-color: firebrick; }

            #actionButton
            {
                background-color: mediumseagreen; color: black; display: inline-block;
                font-family: monospace; font-size: xx-large; text-align: center;
                padding: 20px 20px; border: 3px solid black;
            }
            #actionButton:active { background-color: seagreen; }
            #audioButton
            {
                background-color: slateblue; color: black; display: inline-block;
                font-family: monospace; font-size: xx-large; text-align: center;
                padding: 20px 20px; border: 3px solid black;
            }
            #audioButton:active { background-color: darkslateblue; }
            #pauseButton
            {
                background-color: goldenrod; color: black; display: inline-block;
                font-family: monospace; font-size: xx-large; text-align: center;
                padding: 20px 20px; border: 3px solid black;
            }
            #pauseButton:active { background-color: darkgoldenrod; }
            #controls { background-color: lightgray; border: 5px solid black; }
            
            .prevent-select { -webkit-user-select: none; -ms-user-select: none; user-select: none; }
            .row { display: inline-block; clear: both; }

            @font-face { font-family: "NewSuperMarioFontU"; src: url("resources/fonts/New_Super_Mario_Font_U.ttf"); }
        </style>

        <link rel = "preload" href = "resources/fonts/New_Super_Mario_Font_U.ttf" as = "font">
    </head>

    <body onload = "startGame()">

        <div id = "controls" class = "row" style = "text-align: center; vertical-align: text-bottom;">
            <div id = "joystick" style = "margin-top: 8px; margin-bottom: 8px;"></div>

            <div id = "buttons" class = "prevent-select" style = "margin-bottom: 8px; margin-left: 8px; margin-right: 8px;">
                <button id = "audioButton" onclick = "toggleAudioMuting()"><b>üîä</b></button>
                <button id = "actionButton" onclick = "playerAction()" style = "margin-left: 5px; margin-right: 5px;"><b>üö©</b></button>
                <button id = "pauseButton" onclick = "pauseGame()"><b>‚ùå</b></button>
            </div>
        </div>

        <script>
            // Setup for the start of the game
            function startGame()
            {
                gameArea.start(1024, 768, "border: 5px solid black", "darkgray", 0, 0, 0, 20); 
                saveProgress.load("saveProgress");
                music = new componentSound("", "BGM"), sfx = new componentSound("", "SFX");

                levelSetup.titleScreen();
            }

            // Variables for all game objects along with important global variables
            var player, walls = [], pits = [], treasure = [], warps = [];
            var gameStarted = false, gameIsOver = false;
            var hud = [], music, sfx;

            // Variable for storing and manipulating the player's game completion progress through the use of web storage
            var saveProgress =
            {
                completion: [["Level 1", 0], ["Level 2", 0], ["Level 3", 0], ["Level 4", 0], ["Level 5", 0], ["Level 6", 0],
                             ["Level 7", 0], ["Level 8", 0], ["Level 9", 0], ["Level 10", 0], ["Level A", 0], ["Level B", 0],
                             ["Level C", 0], ["Percentage", 0]],

                save: function(storageName)
                {
                    for (i = 0; i < this.completion.length - 1; i++)
                    {
                        if (this.completion[i][0] == gameArea.currentLevel)
                        {
                            if (hud[1].treasureCollected == treasure.length) { this.completion[i][1] = 2; }
                            else if (this.completion[i][1] != 2) { this.completion[i][1] = 1; } break;
                        }
                    }
                    this.completion[13][1] = 0.00;
                    for (i = 0; i < this.completion.length - 1; i++) { this.completion[13][1] += this.completion[i][1]; }
                    this.completion[13][1] = Math.min(Math.round((this.completion[13][1] / (13 * 2)) * 100), 100);

                    if (typeof(Storage) !== "undefined") { localStorage.setItem(storageName, this.completion); }
                },

                load: function(storageName)
                {
                    if (typeof(Storage) !== "undefined" && localStorage.getItem(storageName) != null)
                    {
                        var decodedStorage = localStorage.getItem(storageName).split(',');

                        for (i = 0, j = 1; i < this.completion.length && j < decodedStorage.length; i++, j += 2)
                        {
                            this.completion[i][1] = Number(decodedStorage[j]);
                        }
                    }
                },

                delete: function(storageName)
                {
                    for (i = 0; i < this.completion.length - 1; i++) { this.completion[i][1] = 0; }
                    this.completion[13][1] = 0;

                    if (typeof(Storage) !== "undefined") { localStorage.removeItem(storageName); }
                }
            }

            // Variable for the playable game area
            var gameArea =
            {
                canvas: document.createElement("canvas"), currentLevel: "",

                start: function(width, height, style, fillColor, x, y, frameNum, updateSpeed)
                {
                    this.canvas.width = width, this.canvas.height = height;
                    this.canvas.style = style, this.fillColor = fillColor;
                    this.x = x, this.y = y;
                    this.frameNum = frameNum, this.updateSpeed = updateSpeed;

                    this.context = this.canvas.getContext("2d");

                    this.context.fillStyle = this.fillColor;
                    this.context.fillRect(this.x, this.y, this.canvas.width, this.canvas.height);

                    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                    this.interval = setInterval(updateGameArea, this.updateSpeed);
                },

                clear: function()
                {
                    this.context.clearRect(this.x, this.y, this.canvas.width, this.canvas.height);
                    this.context.fillStyle = this.fillColor;
                    this.context.fillRect(this.x, this.y, this.canvas.width, this.canvas.height);
                }
            }

            // Variable containing the object setup for every level in the game
            var levelSetup =
            {
                // Setup for the title screen
                titleScreen: function()
                {
                    gameArea.fillColor = "lightgray"; gameArea.currentLevel = "Title Screen"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [];
                    warps = [(new componentWarp(120, 100, 30, 30, 0, "green", 2, "black", "Credits", "N/A")),
                             (new componentWarp(512, 100, 30, 30, 0, "green", 2, "black", "Main Hub", "N/A")),
                             (new componentWarp(974, 718, 30, 30, 0, "dimgray", 2, "black", "Title Screen", "Deletion"))];

                    hud = [(new componentHud("45px NewSuperMarioFontU", "white", "black", 40, 40,
                                "HYPERION'S TREASURE-MAXED LABYRINTH", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 300, 755, "¬©Ô∏è 2025 SuperBro64", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 420, 160, "Main Hub", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 45, 160, "Credits", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "red", "black", 780, 680, "Erase Game", 0, "N/A"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Title.mp3"; if (gameStarted) { music.play(); }
                },

                // Setup for the credits screen
                credits: function()
                {
                    gameArea.fillColor = "lightgray"; gameArea.currentLevel = "Credits Screen"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [];
                    warps = [(new componentWarp(512, 718, 30, 30, 0, "green", 2, "black", "Title Screen", "N/A"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "CREDITS", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 0, 0, "Item 1", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 0, 0, "Credit 1", 0, "N/A"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Credits.mp3"; music.play();
                },

                // Setup for the main hub
                mainHub: function()
                {
                    gameArea.fillColor = "lightgray"; gameArea.currentLevel = "Main Hub"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 604, 20, 0, 2, "red", 2, "black");
                    walls = [(new componentWall(328, 272, 40, 224, "gray", 2, "black", true, "N/A", 0)),
                             (new componentWall(328, 232, 368, 40, "gray", 2, "black", true, "N/A", 0)),
                             (new componentWall(328, 496, 368, 40, "gray", 2, "black", true, "N/A", 0)),
                             (new componentWall(0, 384, 328, 30, "crimson", 2, "black", true, "Progression", 2)),
                             (new componentWall(452, 0, 30, 232, "crimson", 2, "black", true, "Progression", 4)),
                             (new componentWall(666, 272, 30, 224, "crimson", 2, "black", true, "Progression", 7)),
                             (new componentWall(696, 496, 328, 30, "crimson", 2, "black", true, "Progression", 10)),
                             (new componentWall(666, 536, 30, 232, "crimson", 2, "black", true, "Progression", 10))];
                    pits = [];
                    treasure = [];
                    warps = [(new componentWarp(512, 688, 30, 30, 0, "green", 2, "black", "Title Screen", "N/A")),
                             (new componentWarp(370, 644, 30, 30, 0, "sienna", 2, "black", "Level 1", "Level 1")),
                             (new componentWarp(45, 728, 30, 30, 0, "sienna", 2, "black", "Level 2", "Level 2")),
                             (new componentWarp(150, 504, 30, 30, 0, "sienna", 2, "black", "Level 3", "Level 3")),
                             (new componentWarp(240, 310, 30, 30, 0, "sienna", 2, "black", "Level 4", "Level 4")),
                             (new componentWarp(75, 90, 30, 30, 0, "sienna", 2, "black", "Level 5", "Level 5")),
                             (new componentWarp(390, 170, 30, 30, 0, "sienna", 2, "black", "Level 6", "Level 6")),
                             (new componentWarp(700, 110, 30, 30, 0, "sienna", 2, "black", "Level 7", "Level 7")),
                             (new componentWarp(940, 230, 30, 30, 0, "sienna", 2, "black", "Level 8", "Level 8")),
                             (new componentWarp(830, 430, 30, 30, 0, "sienna", 2, "black", "Level 9", "Level 9")),
                             (new componentWarp(512, 384, 30, 30, 0, "sienna", 2, "black", "Level 10", "Level 10")),
                             (new componentWarp(865, 604, 30, 30, 0, "sienna", 2, "black", "Level A", "Level A")),
                             (new componentWarp(765, 704, 30, 30, 0, "sienna", 2, "black", "Level B", "Level B")),
                             (new componentWarp(965, 704, 30, 30, 0, "sienna", 2, "black", "Level C", "Level C"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Main Hub", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 510, 35, "Game Completion: ", 0, "N/A")),
                           (new componentHud("60px NewSuperMarioFontU", "white", "black", 880, 45, "000%", 0, "Completion")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 470, 750, "Exit", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 360, 637, "1", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 35, 721, "2", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 140, 497, "3", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 230, 303, "4", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 65, 83, "5", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 380, 163, "6", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 690, 103, "7", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 930, 223, "8", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 820, 423, "9", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 494, 377, "10", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 852, 597, "A", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 752, 697, "B", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 952, 697, "C", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 80, 411, "2 Levels", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 456, 40, "4", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 456, 90, "L", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 456, 113, "e", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 456, 136, "v", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 456, 159, "e", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 461, 188, "l", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 456, 211, "s", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 310, "7", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 360, "L", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 383, "e", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 406, "v", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 429, "e", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 675, 458, "l", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 481, "s", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 672, 564, "1", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 672, 592, "0", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 642, "L", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 665, "e", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 688, "v", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 711, "e", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 675, 740, "l", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 670, 763, "s", 0, "N/A")),
                           (new componentHud("40px NewSuperMarioFontU", "salmon", "black", 775, 523, "10 Levels", 0, "N/A"))];

                    if (saveProgress.completion[13][1] == 100) { music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Clear.mp3"; }
                    else { music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Menu.mp3"; } music.play();
                },

                // Setup for level 1
                level1: function()
                {
                    gameArea.fillColor = "yellowgreen"; gameArea.currentLevel = "Level 1"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [(new componentWall(392, 500, 240, 50, "gray", 2, "black", true, "N/A", 0)),
                             (new componentWall(342, 310, 50, 240, "gray", 2, "black", true, "N/A", 0)),
                             (new componentWall(632, 310, 50, 240, "gray", 2, "black", true, "N/A", 0))];
                    pits = [(new componentPit(200, 300, 40, 40, "black", 2, "black")),
                            (new componentPit(200, 342, 40, 40, "black", 2, "black")),
                            (new componentPit(200, 384, 40, 40, "black", 2, "black"))];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 1", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_1.mp3"; music.play();
                },

                // Setup for level 2
                level2: function()
                {
                    gameArea.fillColor = "lightcoral"; gameArea.currentLevel = "Level 2"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 2", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_2.mp3"; music.play();
                },

                // Setup for level 3
                level3: function()
                {
                    gameArea.fillColor = "lightskyblue"; gameArea.currentLevel = "Level 3"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 3", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_3.mp3"; music.play();
                },

                // Setup for level 4
                level4: function()
                {
                    gameArea.fillColor = "steelblue"; gameArea.currentLevel = "Level 4"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 4", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_4.mp3"; music.play();
                },

                // Setup for level 5
                level5: function()
                {
                    gameArea.fillColor = "pink"; gameArea.currentLevel = "Level 5"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 5", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_5.mp3"; music.play();
                },

                // Setup for level 6
                level6: function()
                {
                    gameArea.fillColor = "sandybrown"; gameArea.currentLevel = "Level 6"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 6", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_6.mp3"; music.play();
                },

                // Setup for level 7
                level7: function()
                {
                    gameArea.fillColor = "plum"; gameArea.currentLevel = "Level 7"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 7", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_7.mp3"; music.play();
                },

                // Setup for level 8
                level8: function()
                {
                    gameArea.fillColor = "darkorange"; gameArea.currentLevel = "Level 8"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 8", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_8.mp3"; music.play();
                },

                // Setup for level 9
                level9: function()
                {
                    gameArea.fillColor = "gray"; gameArea.currentLevel = "Level 9"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 9", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_9.mp3";  music.play();
                },

                // Setup for level 10
                level10: function()
                {
                    gameArea.fillColor = "slategray"; gameArea.currentLevel = "Level 10"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Credits", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level 10", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_World_10.mp3"; music.play();
                },

                // Setup for level A
                levelA: function()
                {
                    gameArea.fillColor = "khaki"; gameArea.currentLevel = "Level A"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level A", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Bonus.mp3"; music.play();
                },

                // Setup for level B
                levelB: function()
                {
                    gameArea.fillColor = "cornsilk"; gameArea.currentLevel = "Level B"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level B", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Target.mp3"; music.play();
                },

                // Setup for level C
                levelC: function()
                {
                    gameArea.fillColor = "mediumseagreen"; gameArea.currentLevel = "Level C"; gameArea.frameNum = 0;

                    player = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black");
                    walls = [];
                    pits = [];
                    treasure = [(new componentTreasure(256, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(256, 576, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 192, 10, 0, 2, "gold", 2, "black")),
                                (new componentTreasure(768, 576, 10, 0, 2, "gold", 2, "black"))];
                    warps = [(new componentWarp(512, 100, 30, 30, 0, "cyan", 2, "black", "Main Hub", "Goal"))];

                    hud = [(new componentHud("40px NewSuperMarioFontU", "white", "black", 10, 35, "Level C", 0, "Level")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 430, 35, "ü™ô", 0, "Treasure")),
                           (new componentHud("40px NewSuperMarioFontU", "white", "black", 870, 35, "‚è±Ô∏è", 120, "Timer"))];
                    music.sound.src = "resources/sounds/Super_Monkey_Ball_2_-_Soccer.mp3"; music.play();
                }
            }

            // Code for the player
            function componentPlayer(x, y, radius, startAngle, endAngle, fillColor, lineWidth, lineColor)
            {
                this.speedX = 0, this.speedY = 0;
                this.x = x, this.y = y, this.radius = radius;
                this.startAngle = startAngle, this.endAngle = endAngle;
                this.fillColor = fillColor, this.lineWidth = lineWidth, this.lineColor = lineColor;
                this.action = false, this.falling = false;
                this.originalX = x, this.originalY = y, this.originalRadius = radius;

                this.update = function()
                {
                    this.context = gameArea.context;

                    this.context.beginPath();
                    this.context.arc(this.x, this.y, this.radius, this.startAngle, this.endAngle * Math.PI);
                    this.context.fillStyle = this.fillColor;
                    this.context.fill();

                    this.context.lineWidth = this.lineWidth;
                    this.context.strokeStyle = this.lineColor;
                    this.context.stroke();

                    this.action = false;

                    if (this.falling)
                    {
                        this.radius -= 0.15;

                        if (this.radius <= 0)
                        {
                            this.falling = false;
                            this.x = this.originalX; this.y = this.originalY; this.radius = this.originalRadius;

                            document.querySelector("#actionButton").innerHTML = "üÖ∞Ô∏è";
                            document.querySelector("#pauseButton").innerHTML = "‚è∏Ô∏è";
                        }
                    }
                }

                // Calculates each frame the new x and y positions of the player as they move around
                this.newPosition = function()
                {
                    if (this.falling) { return; }

                    var stickX = joystick.getX(), stickY = joystick.getY();
                    var stickAngle = Math.atan2(stickY, stickX) * 180 / Math.PI;

                    if (stickAngle < 0) { stickAngle += 360; }

                    if (stickX < 25 && stickX > -25 && stickY < 25 && stickY > -25) { this.stopMoving(); }
                    else
                    {
                        if ((stickAngle >= 0 && stickAngle < 11.25) || (stickAngle >= 348.75 && stickAngle < 360)) { this.moveRight(); }
                        else if (stickAngle >= 11.25 && stickAngle < 33.75) { this.moveRightDownRight(); }
                        else if (stickAngle >= 33.75 && stickAngle < 56.25) { this.moveDownRight(); }
                        else if (stickAngle >= 56.25 && stickAngle < 78.75) { this.moveDownDownRight(); }
                        else if (stickAngle >= 78.75 && stickAngle < 101.25) { this.moveDown(); }
                        else if (stickAngle >= 101.25 && stickAngle < 123.75) { this.moveDownDownLeft(); }
                        else if (stickAngle >= 123.75 && stickAngle < 146.25) { this.moveDownLeft(); }
                        else if (stickAngle >= 146.25 && stickAngle < 168.75) { this.moveLeftDownLeft(); }
                        else if (stickAngle >= 168.75 && stickAngle < 191.25) { this.moveLeft(); }
                        else if (stickAngle >= 191.25 && stickAngle < 213.75) { this.moveLeftUpLeft(); }
                        else if (stickAngle >= 213.75 && stickAngle < 236.25) { this.moveUpLeft(); }
                        else if (stickAngle >= 236.25 && stickAngle < 258.75) { this.moveUpUpLeft(); }
                        else if (stickAngle >= 258.75 && stickAngle < 281.25) { this.moveUp(); }
                        else if (stickAngle >= 281.25 && stickAngle < 303.75) { this.moveUpUpRight(); }
                        else if (stickAngle >= 303.75 && stickAngle < 326.25) { this.moveUpRight(); }
                        else if (stickAngle >= 326.25 && stickAngle < 348.75) { this.moveRightUpRight(); }

                        if (stickX < 75 && stickX > -75) { this.speedX /= 2; }
                        if (stickY < 75 && stickY > -75) { this.speedY /= 2; }
                    }

                    this.x += this.speedX; this.y += this.speedY;

                    this.x = Math.max(0 + this.radius, Math.min(this.x, gameArea.canvas.width - this.radius));
                    this.y = Math.max(0 + this.radius, Math.min(this.y, gameArea.canvas.height - this.radius));
                }

                // The speed values associated with all 16 movement directions as well as no direction
                this.moveRight = function()          { this.speedX = 4,      this.speedY = 0; }
                this.moveRightDownRight = function() { this.speedX = 3.464,  this.speedY = -2; }
                this.moveDownRight = function()      { this.speedX = 2.828,  this.speedY = -2.828; }
                this.moveDownDownRight = function()  { this.speedX = 2,      this.speedY = -3.464; }
                this.moveDown = function()           { this.speedX = 0,      this.speedY = -4; }
                this.moveDownDownLeft = function()   { this.speedX = -2,     this.speedY = -3.464; }
                this.moveDownLeft = function()       { this.speedX = -2.828, this.speedY = -2.828; }
                this.moveLeftDownLeft = function()   { this.speedX = -3.464, this.speedY = -2; }
                this.moveLeft = function()           { this.speedX = -4,     this.speedY = 0; }
                this.moveLeftUpLeft = function()     { this.speedX = -3.464, this.speedY = 2; }
                this.moveUpLeft = function()         { this.speedX = -2.828, this.speedY = 2.828; }
                this.moveUpUpLeft = function()       { this.speedX = -2,     this.speedY = 3.464; }
                this.moveUp = function()             { this.speedX = 0,      this.speedY = 4; }
                this.moveUpUpRight = function()      { this.speedX = 2,      this.speedY = 3.464; }
                this.moveUpRight = function()        { this.speedX = 2.828,  this.speedY = 2.828; }
                this.moveRightUpRight = function()   { this.speedX = 3.464,  this.speedY = 2; }
                this.stopMoving = function()         { this.speedX = 0,      this.speedY = 0; }

                // Check for collision with any object
                this.objectCollision = function(object)
                {
                    var left = this.x - this.radius, right = this.x + this.radius;
                    var top = this.y - this.radius, bottom = this.y + this.radius;

                    var objLeft, objRight, objTop, objBottom;

                    if (object.radius > 0)
                    {
                        objLeft = object.x - object.radius, objRight = object.x + object.radius;
                        objTop = object.y - object.radius, objBottom = object.y + object.radius;
                    }
                    else
                    {
                        objLeft = object.x, objRight = object.x + object.width;
                        objTop = object.y, objBottom = object.y + object.height;
                    }

                    return ((bottom > objTop) && (top < objBottom) && (right > objLeft) && (left < objRight));
                }

                // Handle collision with solid walls, pushing the player away from them
                this.handleWallCollision = function(wall)
                {
                    if (!wall.tangibility) { return; }
                    
                    var overlapX = Math.min(this.x + this.radius, wall.x + wall.width) - Math.max(this.x - this.radius, wall.x);
                    var overlapY = Math.min(this.y + this.radius, wall.y + wall.height) - Math.max(this.y - this.radius, wall.y);

                    if (overlapX < overlapY)
                    {
                        if (this.x < wall.x) { this.x -= overlapX; }
                        else { this.x += overlapX; }
                    }
                    else
                    {
                        if (this.y < wall.y) { this.y -= overlapY; }
                        else { this.y += overlapY; }
                    }
                }

                // Handle the player falling into a bottomless pit
                this.pitFalling = function(pit)
                {
                    this.falling = true; pit.sfx.play();
                    this.x = pit.x + (pit.width / 2); this.y = pit.y + (pit.height / 2);

                    document.querySelector("#actionButton").innerHTML = "‚ùå";
                    document.querySelector("#pauseButton").innerHTML = "‚ùå";
                }
            }

            // Code for the walls
            function componentWall(x, y, width, height, fillColor, lineWidth, lineColor, tangibility, type, levels)
            {
                this.x = x, this.y = y, this.width = width, this.height = height;
                this.fillColor = fillColor, this.lineWidth = lineWidth, this.lineColor = lineColor;
                this.tangibility = tangibility, this.type = type, this.levels = levels;

                if (this.type == "Progression" && this.levels > 0)
                {
                    var levelsCompleted = 0;

                    for (i = 0; i < saveProgress.completion.length - 1; i++)
                    {
                        if (saveProgress.completion[i][1] >= 1) { levelsCompleted++; }
                    }

                    if (levelsCompleted >= this.levels) { this.tangibility = false; }
                }

                this.update = function()
                {
                    this.context = gameArea.context;

                    if (!this.tangibility) { this.context.globalAlpha = 0.5; }

                    this.context.fillStyle = this.fillColor;
                    this.context.fillRect(this.x, this.y, this.width, this.height);

                    this.context.globalAlpha = 1.0;

                    this.context.lineWidth = this.lineWidth;
                    this.context.strokeStyle = this.lineColor;
                    this.context.strokeRect(this.x, this.y, this.width, this.height);
                }
            }

            // Code for the bottomless pits
            function componentPit(x, y, width, height, fillColor, lineWidth, lineColor)
            {
                this.x = x, this.y = y, this.width = width, this.height = height;
                this.fillColor = fillColor, this.lineWidth = lineWidth, this.lineColor = lineColor;
                this.sfx = new componentSound("resources/sounds/Super_Mario_64_-_Falling.mp3", "SFX");

                this.update = function()
                {
                    this.context = gameArea.context;

                    this.context.fillStyle = this.fillColor;
                    this.context.fillRect(this.x, this.y, this.width, this.height);

                    this.context.lineWidth = this.lineWidth;
                    this.context.strokeStyle = this.lineColor;
                    this.context.strokeRect(this.x, this.y, this.width, this.height);
                }
            }

            // Code for the treasure
            function componentTreasure(x, y, radius, startAngle, endAngle, fillColor, lineWidth, lineColor)
            {
                this.x = x, this.y = y, this.radius = radius;
                this.startAngle = startAngle, this.endAngle = endAngle;
                this.fillColor = fillColor, this.lineWidth = lineWidth, this.lineColor = lineColor;
                this.sfx = new componentSound("resources/sounds/Super_Mario_64_-_Coin.wav", "SFX");

                this.update = function()
                {
                    this.context = gameArea.context;

                    this.context.beginPath();
                    this.context.arc(this.x, this.y, this.radius, this.startAngle, this.endAngle * Math.PI);
                    this.context.fillStyle = this.fillColor;
                    this.context.fill();

                    this.context.lineWidth = this.lineWidth;
                    this.context.strokeStyle = this.lineColor;
                    this.context.stroke();
                }

                this.disappear = function() { this.radius = 0; this.sfx.play(); }
            }

            // Code for the warps
            function componentWarp(x, y, width, height, angle, fillColor, lineWidth, lineColor, destination, type)
            {
                this.x = x, this.y = y, this.width = width, this.height = height, this.angle = angle;
                this.fillColor = fillColor, this.lineWidth = lineWidth, this.lineColor = lineColor;
                this.rotationSpeed = 180, this.destination = destination, this.type = type;
                this.sfx = new componentSound("resources/sounds/Super_Mario_64_-_Enter_Course.wav", "SFX");

                for (i = 0; i < saveProgress.completion.length - 1; i++)
                {
                    if (saveProgress.completion[i][0] == this.type)
                    {
                        if (saveProgress.completion[i][1] == 0) { this.fillColor = "sienna"; }
                        else if (saveProgress.completion[i][1] == 1) { this.fillColor = "silver"; }
                        else if (saveProgress.completion[i][1] == 2) { this.fillColor = "gold"; }
                        break;
                    }
                }

                this.update = function()
                {
                    this.context = gameArea.context;
                    this.context.save();

                    this.context.translate(this.x, this.y);
                    this.context.rotate(this.angle);

                    this.context.fillStyle = this.fillColor;
                    this.context.fillRect(this.width / -2, this.height / -2, this.width, this.height);

                    this.context.lineWidth = this.lineWidth;
                    this.context.strokeStyle = this.lineColor;
                    this.context.strokeRect(this.width / -2, this.height / -2, this.width, this.height);

                    this.context.restore();

                    this.angle += (1 * Math.PI / this.rotationSpeed);
                }

                this.toDestination = function()
                {
                    music.stop(); this.sfx.play();

                    if (this.type == "Goal") { saveProgress.save("saveProgress"); }
                    else if (this.type == "Deletion") { saveProgress.delete("saveProgress"); }

                    switch (this.destination)
                    {
                        case "Title Screen": levelSetup.titleScreen(); break;
                        case "Credits":      levelSetup.credits(); break;
                        case "Main Hub":     levelSetup.mainHub(); break;
                        case "Level 1":      levelSetup.level1(); break;
                        case "Level 2":      levelSetup.level2(); break;
                        case "Level 3":      levelSetup.level3(); break;
                        case "Level 4":      levelSetup.level4(); break;
                        case "Level 5":      levelSetup.level5(); break;
                        case "Level 6":      levelSetup.level6(); break;
                        case "Level 7":      levelSetup.level7(); break;
                        case "Level 8":      levelSetup.level8(); break;
                        case "Level 9":      levelSetup.level9(); break;
                        case "Level 10":     levelSetup.level10(); break;
                        case "Level A":      levelSetup.levelA(); break;
                        case "Level B":      levelSetup.levelB(); break;
                        case "Level C":      levelSetup.levelC(); break;
                        default:             levelSetup.titleScreen(); break;
                    }
                }
            }

            // Code for the heads-up display
            function componentHud(font, fillColor, outlineColor, x, y, text, startingTime, type)
            {
                this.treasureCollected = 0, this.startingTime = startingTime; this.type = type;
                this.timeRemaining = (this.startingTime - (gameArea.frameNum / 50)).toFixed(1);

                this.font = font, this.fillColor = fillColor, this.outlineColor = outlineColor;
                this.x = x, this.y = y, this.text = text;

                this.update = function()
                {
                    this.context = gameArea.context;
                    this.context.font = this.font;

                    this.context.fillStyle = this.fillColor;
                    this.context.fillText(this.text, this.x, this.y);
                    this.context.strokeStyle = this.outlineColor;
                    this.context.strokeText(this.text, this.x, this.y);
                }
            }

            // Code for playing the game's background music and sound effects
            function componentSound(source, type)
            {
                this.sound = document.createElement("audio");
                this.sound.src = source; this.type = type;

                if (this.type == "BGM") { this.sound.loop = true; this.sound.volume = 0.3; }
                else if (this.type == "SFX") { this.sound.loop = false; this.sound.volume = 0.5; }

                this.sound.setAttribute("preload", "auto");
                this.sound.setAttribute("controls", "none");
                this.sound.style.display = "none";
                document.body.appendChild(this.sound);

                this.play = function() { this.sound.play(); }
                this.stop = function() { this.sound.pause(); }
            }

            // Code for updating the game area and everything in it on every frame
            function updateGameArea()
            {
                // Clearing the game area
                gameArea.clear();
                if (!player.falling) { gameArea.frameNum += 1; }

                // Updating the walls
                for (i = 0; i < walls.length; i++)
                {
                    if (player.objectCollision(walls[i])) { player.handleWallCollision(walls[i]); }

                    if (walls[i]) { walls[i].update(); }
                }

                // Updating the bottomless pits
                for (i = 0; i < pits.length; i++)
                {
                    if (player.objectCollision(pits[i])) { player.pitFalling(pits[i]); }

                    if (pits[i]) { pits[i].update(); }
                }

                // Updating the treasure
                for (i = 0; i < treasure.length; i++)
                {
                    if (player.objectCollision(treasure[i]) && treasure[i].radius != 0)
                    {
                        treasure[i].disappear();
                        hud[1].treasureCollected += 1;
                    }

                    if (treasure[i]) { treasure[i].update(); }
                }

                // Updating the warps
                for (i = 0; i < warps.length; i++)
                {
                    if (player.objectCollision(warps[i]))
                    {
                        warps[i].rotationSpeed = 45;

                        if (player.action) { warps[i].toDestination(); }
                    }
                    else { warps[i].rotationSpeed = 180; }

                    if (warps[i]) { warps[i].update(); }
                }

                // Updating the HUD
                for (i = 0; i < hud.length; i++)
                {
                    if (hud[i].type == "Treasure" && treasure.length > 0)
                    {
                        if (hud[i].treasureCollected == treasure.length) { hud[i].fillColor = "gold"; }

                        hud[i].text = "ü™ô";
                        hud[i].text += hud[i].treasureCollected + "/" + treasure.length;
                    }
                    else if (hud[i].type == "Completion")
                    {
                        if (saveProgress.completion[13][1] == 100) { hud[i].fillColor = "gold"; }

                        hud[i].text = "";
                        if (saveProgress.completion[13][1] < 10) { hud[i].text += "00"; }
                        else if (saveProgress.completion[13][1] < 100) { hud[i].text += "0"; }
                        hud[i].text += saveProgress.completion[13][1] + "%";
                    }
                    else if (hud[i].type == "Timer" && hud[i].startingTime > 0)
                    {
                        if (hud[i].timeRemaining > 0)
                        {
                            hud[i].timeRemaining = (hud[i].startingTime - (gameArea.frameNum / 50)).toFixed(1);
                        }
                        if (hud[i].timeRemaining < 10) { hud[i].fillColor = "red"; }

                        hud[i].text = "‚è±Ô∏è";
                        if (hud[i].timeRemaining < 10) { hud[i].text += "00"; }
                        else if (hud[i].timeRemaining < 100) { hud[i].text += "0"; }
                        hud[i].text += hud[i].timeRemaining;
                    }

                    if (hud[i]) { hud[i].update(); }
                }

                // Updating the music and sound effects
                if (!music.sound.muted) { document.querySelectorAll("audio").forEach((element) => element.muted = false); }
                else if (music.sound.muted) { document.querySelectorAll("audio").forEach((element) => element.muted = true); }

                // Updating the player
                player.newPosition();
                if (player) { player.update(); }

                if (hud[2].startingTime > 0 && hud[2].timeRemaining <= 0 && !gameIsOver) { gameOver(); }
                if (!gameStarted) { waitForStart(); }
            }

            // Code for tracking if something is happening every n frames
            function everyInterval(n)
            {
                if ((gameArea.frameNum / n) % 1 == 0) { return true; }
                return false;
            }

            // Code for before the game starts, waiting for player input
            function waitForStart()
            { 
                var gameStartOverlay = [(new componentWall(0, 0, gameArea.canvas.width, gameArea.canvas.height,
                                        "gray", 0, "black", false, "N/A", 0))];
                for (i = 0; i < gameStartOverlay.length; i++) { gameStartOverlay[i].update(); }

                var gameStartText = [(new componentHud("45px NewSuperMarioFontU", "white", "black", 40, 40,
                                        "HYPERION'S TREASURE-MAXED LABYRINTH", 0, "Level")),
                                     (new componentHud("40px NewSuperMarioFontU", "white", "black", 300, 755,
                                        "¬©Ô∏è 2025 SuperBro64", 0, "N/A")),
                                     (new componentHud("40px NewSuperMarioFontU", "white", "black", 310, 500,
                                        "Click on üö© to play!", 0, "N/A"))];
                for (i = 0; i < gameStartText.length; i++) { gameStartText[i].update(); }
                
                var gameStartPlayer = new componentPlayer(512, 384, 20, 0, 2, "red", 2, "black"); gameStartPlayer.update();

                clearInterval(gameArea.interval); gameArea.interval = null;
            }

            // Code for the game over that occurs when the level time has run out
            function gameOver()
            {
                gameIsOver = true;

                document.querySelector("#actionButton").innerHTML = "üè†";
                document.querySelector("#pauseButton").innerHTML = "üîÑÔ∏è";

                var gameOverOverlay = [(new componentWall(0, 0, gameArea.canvas.width, gameArea.canvas.height,
                                        "gray", 0, "black", false, "N/A", 0))];
                for (i = 0; i < gameOverOverlay.length; i++) { gameOverOverlay[i].update(); }
                
                var gameOverText = [(new componentHud("60px NewSuperMarioFontU", "red", "black", 350, 364, "GAME OVER", 0, "N/A")),
                                    (new componentHud("40px NewSuperMarioFontU", "red", "black", 220, 414,
                                        "Click üîÑÔ∏è to restart the level.", 0, "N/A")),
                                    (new componentHud("40px NewSuperMarioFontU", "red", "black", 215, 464,
                                        "Click üè† to return to the hub.", 0, "N/A"))];
                for (i = 0; i < gameOverText.length; i++) { gameOverText[i].update(); }

                sfx.sound.src = "resources/sounds/Super_Mario_64_-_Game_Over.wav"; sfx.play();
                clearInterval(gameArea.interval); gameArea.interval = null;
            }

            // Code for restarting the current level the player is on after a Game Over occurs
            function levelRestart()
            {
                switch (gameArea.currentLevel)
                {
                    case "Title Screen": levelSetup.titleScreen(); break;
                    case "Credits":      levelSetup.credits(); break;
                    case "Main Hub":     levelSetup.mainHub(); break;
                    case "Level 1":      levelSetup.level1(); break;
                    case "Level 2":      levelSetup.level2(); break;
                    case "Level 3":      levelSetup.level3(); break;
                    case "Level 4":      levelSetup.level4(); break;
                    case "Level 5":      levelSetup.level5(); break;
                    case "Level 6":      levelSetup.level6(); break;
                    case "Level 7":      levelSetup.level7(); break;
                    case "Level 8":      levelSetup.level8(); break;
                    case "Level 9":      levelSetup.level9(); break;
                    case "Level 10":     levelSetup.level10(); break;
                    case "Level A":      levelSetup.levelA(); break;
                    case "Level B":      levelSetup.levelB(); break;
                    case "Level C":      levelSetup.levelC(); break;
                    default:             levelSetup.titleScreen(); break;
                }
            }

            // Code for the player's actions during normal gameplay, or for returning to the main hub during a pause or Game Over
            function playerAction()
            {
                if (!gameStarted)
                {
                    document.querySelector("#actionButton").innerHTML = "üÖ∞Ô∏è";
                    document.querySelector("#pauseButton").innerHTML = "‚è∏Ô∏è";

                    gameArea.interval = setInterval(updateGameArea, gameArea.updateSpeed);

                    music.play();
                    gameStarted = true;
                }
                else if (!gameArea.interval && gameIsOver)
                {
                    document.querySelector("#actionButton").innerHTML = "üÖ∞Ô∏è";
                    document.querySelector("#pauseButton").innerHTML = "‚è∏Ô∏è";

                    gameIsOver = false; sfx.stop();

                    sfx.sound.src = "resources/sounds/Super_Mario_64_-_Enter_Course.wav"; sfx.play();
                    gameArea.interval = setInterval(updateGameArea, gameArea.updateSpeed);

                    levelSetup.mainHub();
                }
                else if (!gameArea.interval && !gameIsOver)
                {
                    document.querySelector("#actionButton").innerHTML = "üÖ∞Ô∏è";
                    document.querySelector("#pauseButton").innerHTML = "‚è∏Ô∏è";

                    sfx.sound.src = "resources/sounds/Super_Mario_64_-_Enter_Course.wav"; sfx.play();
                    gameArea.interval = setInterval(updateGameArea, gameArea.updateSpeed);

                    levelSetup.mainHub();
                }
                else if (gameArea.interval && !gameIsOver) { player.action = true; }
            }

            // Code for pausing the game during normal gameplay, or for restarting the current level after getting a Game Over
            function pauseGame()
            {
                if (gameStarted && !gameIsOver && !player.falling)
                {
                    if (gameArea.interval)
                    {
                        document.querySelector("#actionButton").innerHTML = "üè†";
                        document.querySelector("#pauseButton").innerHTML = "‚ñ∂Ô∏è";

                        var pauseOverlay = [(new componentWall(0, 0, gameArea.canvas.width, gameArea.canvas.height,
                                                "gray", 0, "black", false, "N/A", 0))];
                        for (i = 0; i < pauseOverlay.length; i++) { pauseOverlay[i].update(); }

                        var pauseText = [(new componentHud("60px NewSuperMarioFontU", "white", "black", 400, 364, "PAUSED", 0, "N/A")),
                                         (new componentHud("40px NewSuperMarioFontU", "white", "black", 220, 414,
                                            "Click ‚ñ∂Ô∏è to resume the game.", 0, "N/A")),
                                         (new componentHud("40px NewSuperMarioFontU", "white", "black", 215, 464,
                                            "Click üè† to return to the hub.", 0, "N/A"))];
                        for (i = 0; i < pauseText.length; i++) { pauseText[i].update(); }

                        sfx.sound.src = "resources/sounds/Super_Mario_64_-_Pause.wav"; sfx.play();
                        clearInterval(gameArea.interval); gameArea.interval = null;
                    }
                    else if (!gameArea.interval)
                    {
                        document.querySelector("#actionButton").innerHTML = "üÖ∞Ô∏è";
                        document.querySelector("#pauseButton").innerHTML = "‚è∏Ô∏è";

                        sfx.sound.src = "resources/sounds/Super_Mario_64_-_Pause.wav"; sfx.play();
                        gameArea.interval = setInterval(updateGameArea, gameArea.updateSpeed);
                    }
                }
                else if (gameStarted && gameIsOver && !gameArea.interval)
                {
                    document.querySelector("#actionButton").innerHTML = "üÖ∞Ô∏è";
                    document.querySelector("#pauseButton").innerHTML = "‚è∏Ô∏è";

                    gameIsOver = false; sfx.stop();
                    gameArea.interval = setInterval(updateGameArea, gameArea.updateSpeed);

                    levelRestart();
                }
            }

            // Code for muting and unmuting the background music and all sound effects
            function toggleAudioMuting()
            {
                if (!music.sound.muted) { document.querySelector("#audioButton").innerHTML = "üîá"; music.sound.muted = true; }
                else if (music.sound.muted) { document.querySelector("#audioButton").innerHTML = "üîä"; music.sound.muted = false; }
            }

            // IDEAS TO IMPLEMENT
            // - Door Switches + Door Blocks
            // - Toggle Switches + Toggle Blocks
            // - Shrinkers + Growers
            // - Big Door Switches + Big Toggle Switches
            // - Push Blocks

            // ISSUES
            // - Music not muting when game interval is paused
            // - Text on game start overlay not using custom font

            // Code for the joystick, originally by Bobboteck (Roberto D'Amico) on GitHub
            let StickStatus = { xPosition: 0, yPosition: 0, x: 0, y: 0, cardinalDirection: "C" };
            
            var JoyStick = (function (container, parameters, callback)
            {
                parameters = parameters || {};
                var title = (typeof parameters.title === "undefined" ? "joystick" : parameters.title),
                    width = (typeof parameters.width === "undefined" ? 0 : parameters.width),
                    height = (typeof parameters.height === "undefined" ? 0 : parameters.height),
                    internalFillColor = (typeof parameters.internalFillColor === "undefined" ? "darkgray" : parameters.internalFillColor),
                    internalLineWidth = (typeof parameters.internalLineWidth === "undefined" ? 3 : parameters.internalLineWidth),
                    internalStrokeColor = (typeof parameters.internalStrokeColor === "undefined" ? "dimgray" : parameters.internalStrokeColor),
                    externalLineWidth = (typeof parameters.externalLineWidth === "undefined" ? 3 : parameters.externalLineWidth),
                    externalStrokeColor = (typeof parameters.externalStrokeColor === "undefined" ? "dimgray" : parameters.externalStokeColor),
                    autoReturnToCenter = (typeof parameters.autoReturnToCenter === "undefined" ? true : parameters.autoReturnToCenter);
                
                callback = callback || function(StickStatus) {};

                var objContainer = document.getElementById(container);
                objContainer.style.touchAction = "none";

                var canvas = document.createElement("canvas");
                canvas.id = title;
                
                if (width === 0) { width = objContainer.clientWidth; }
                if (height === 0) { height = objContainer.clientHeight; }
                canvas.width = width, canvas.height = height;
                
                objContainer.appendChild(canvas);
                var context = canvas.getContext("2d");

                var pressed = 0;
                var circumference = 2 * Math.PI;
                var internalRadius = (canvas.width - ((canvas.width / 2) + 10)) / 2;
                var maxMoveStick = internalRadius + 5;
                var externalRadius = internalRadius + 30;
                var centerX = canvas.width / 2;
                var centerY = canvas.height / 2;
                var directionHorizontalLimitPos = canvas.width / 10;
                var directionHorizontalLimitNeg = directionHorizontalLimitPos * -1;
                var directionVerticalLimitPos = canvas.height / 10;
                var directionVerticalLimitNeg = directionVerticalLimitPos * -1;

                var movedX = centerX, movedY = centerY;

                if ("ontouchstart" in document.documentElement)
                {
                    canvas.addEventListener("touchstart", onTouchStart, false);
                    document.addEventListener("touchmove", onTouchMove, false);
                    document.addEventListener("touchend", onTouchEnd, false);
                }
                else
                {
                    canvas.addEventListener("mousedown", onMouseDown, false);
                    document.addEventListener("mousemove", onMouseMove, false);
                    document.addEventListener("mouseup", onMouseUp, false);
                }

                drawExternal(); drawInternal();

                function drawExternal()
                {
                    context.beginPath();
                    context.arc(centerX, centerY, externalRadius, 0, circumference, false);
                    context.lineWidth = externalLineWidth;
                    context.strokeStyle = externalStrokeColor;
                    context.stroke();
                }

                function drawInternal()
                {
                    context.beginPath();
                    if (movedX < internalRadius) { movedX = maxMoveStick; }
                    if ((movedX + internalRadius) > canvas.width) { movedX = canvas.width - maxMoveStick; }
                    if (movedY < internalRadius) { movedY = maxMoveStick; }
                    if ((movedY + internalRadius) > canvas.height) { movedY = canvas.height - maxMoveStick; }
                    context.arc(movedX, movedY, internalRadius, 0, circumference, false);

                    var grd = context.createRadialGradient(centerX, centerY, 5, centerX, centerY, 200);
                    grd.addColorStop(0, internalFillColor);
                    grd.addColorStop(1, internalStrokeColor);
                    context.fillStyle = grd;
                    context.fill();
                    context.lineWidth = internalLineWidth;
                    context.strokeStyle = internalStrokeColor;
                    context.stroke();
                }

                let touchId = null;
                function onTouchStart(event) { pressed = 1; touchId = event.targetTouches[0].identifier; }

                function onTouchMove(event)
                {
                    if (pressed === 1 && event.targetTouches[0].target === canvas)
                    {
                        movedX = event.targetTouches[0].pageX, movedY = event.targetTouches[0].pageY;

                        if (canvas.offsetParent.tagName.toUpperCase() === "BODY")
                        {
                            movedX -= canvas.offsetLeft, movedY -= canvas.offsetTop;
                        }
                        else
                        {
                            movedX -= canvas.offsetParent.offsetLeft, movedY -= canvas.offsetParent.offsetTop;
                        }

                        context.clearRect(0, 0, canvas.width, canvas.height);
                        drawExternal(); drawInternal();

                        StickStatus.xPosition = movedX, StickStatus.yPosition = momveY;
                        StickStatus.x = (100 * ((movedX - centerX) / maxMoveStick)).toFixed();
                        StickStatus.y = ((100 * ((movedY - centerY) / maxMoveStick)) * -1).toFixed();
                        StickStatus.cardinalDirection = getCardinalDirection();
                        callback(StickStatus);
                    }
                }

                function onTouchEnd(event)
                {
                    if (event.changedTouches[0].identifier !== touchId) { return; }

                    pressed = 0;

                    if (autoReturnToCenter) { movedX = centerX, movedY = centerY; }

                    context.clearRect(0, 0, canvas.width, canvas.height);
                    drawExternal(); drawInternal();

                    StickStatus.xPosition = movedX, StickStatus.yPosition = movedY;
                    StickStatus.x = (100 * ((movedX - centerX) / maxMoveStick)).toFixed();
                    StickStatus.y = ((100 * ((movedY - centerY) / maxMoveStick)) * -1).toFixed();
                    StickStatus.cardinalDirection = getCardinalDirection();
                    callback(StickStatus);
                }

                function onMouseDown(event) { pressed = 1; }

                function onMouseMove(event)
                {
                    if (pressed === 1)
                    {
                        movedX = event.pageX, movedY = event.pageY;

                        if (canvas.offsetParent.tagName.toUpperCase() === "BODY")
                        {
                            movedX -= canvas.offsetLeft, movedY -= canvas.offsetTop;
                        }
                        else
                        {
                            movedX -= canvas.offsetParent.offsetLeft, movedY -= canvas.offsetParent.offsetTop;
                        }

                        context.clearRect(0, 0, canvas.width, canvas.height);
                        drawExternal(); drawInternal();

                        StickStatus.xPosition = movedX, StickStatus.yPosition = movedY;
                        StickStatus.x = (100 * ((movedX - centerX) / maxMoveStick)).toFixed();
                        StickStatus.y = ((100 * ((movedY - centerY) / maxMoveStick)) * -1).toFixed();
                        StickStatus.cardinalDirection = getCardinalDirection();
                        callback(StickStatus);
                    }
                }

                function onMouseUp(event)
                {
                    pressed = 0;

                    if (autoReturnToCenter) { movedX = centerX, movedY = centerY; }

                    context.clearRect(0, 0, canvas.width, canvas.height);
                    drawExternal(); drawInternal();

                    StickStatus.xPosition = movedX, StickStatus.yPosition = movedY;
                    StickStatus.x = (100 * ((movedX - centerX) / maxMoveStick)).toFixed();
                    StickStatus.y = ((100 * ((movedY - centerY) / maxMoveStick)) * -1).toFixed();
                    StickStatus.cardinalDirection = getCardinalDirection();
                    callback(StickStatus);
                }

                function getCardinalDirection()
                {
                    let result = "";
                    let horizontal = movedX - centerX;
                    let vertical = movedY - centerY;

                    if (vertical >= directionVerticalLimitNeg && vertical <= directionVerticalLimitPos) { result = "C"; }
                    if (vertical < directionVerticalLimitNeg) { result = "N"; }
                    if (vertical > directionVerticalLimitPos) { result = "S"; }

                    if (horizontal < directionHorizontalLimitNeg)
                    {
                        if (result === "C") { result = "W"; }
                        else { result += "W"; }
                    }
                    if (horizontal > directionHorizontalLimitPos)
                    {
                        if (result === "C") { result = "E"; }
                        else { result += "E"; }
                    }

                    return result;
                }

                this.getWidth = function () { return canvas.width; };
                this.getHeight = function () { return canvas.height; };
                this.getPosX = function () { return movedX; };
                this.getPosY = function () { return movedY; };
                this.getX = function () { return (100 * ((movedX - centerX) / maxMoveStick)).toFixed(); };
                this.getY = function () { return ((100 * ((movedY - centerY) / maxMoveStick)) * -1).toFixed(); };
                this.getDir = function () { return getCardinalDirection(); };
            });

            var joystickInputPosX, joystickInputPosY, joystickDirection, joystickX, joystickY;
            
            var joystick = new JoyStick("joystick", { "title": "joystick", "width": 250, "height": 250 }, function(stickData)
            {
                joystickInputPosX = stickData.xPosition;
                joystickInputPosY = stickData.yPosition;
                joystickDirection = stickData.cardinalDirection;
                joystickX = stickData.x;
                joystickY = stickData.y;
            });
        </script>

        <br>
        
        <h1>
            Hyperion's Treasure-Maxed Labyrinth (WIP)
        </h1>

        <h2>
            Description
        </h2>

        <p>
            Take control of legendary explorer Hyperion and guide him through a dangerous labyrinth full of traps and treasure!
            In each level you must solve puzzles and navigate obstacles to reach the goal before time runs out, collecting as
            much treasure as you can along the way. Successfully clear a level in time to increase your overall completion
            percentage. Collect all of the treasure in the level first to increase your completion percentage even more! Can you
            clear every level and reach 100% total completion? Good luck!
        </p>

        <h2>
            Controls
        </h2>

        <p>
            - üîò Joystick: Hold-click on the central circle and drag it away from the center to move in that direction. Drag the
            central circle a little bit away to move slowly and a lot away to move quickly. Drag the central circle back to the
            center or release the click to stop moving.
            <br><br>
            - üÖ∞Ô∏è Button: Click to perform situation-specific actions when positioned on top of certain objects, such as warp
            zones or switch tiles.
            <br>
            - ‚è∏Ô∏è Button: Click to toggle between pausing and resuming all gameplay functions.
            <br>
            - üîä Button: Click to toggle between muting and unmuting the background music and all sound effects.
            <br><br>
            - üö© Button: Click while on the title screen to begin the game.
            <br>
            - üè† Button: Click while the game is paused or after getting a Game Over to return immediately to the main level hub.
            <br>
            - üîÑÔ∏è Button: Click after getting a Game Over to restart the current level.
            <br>
            - ‚ùå Button: Does nothing when clicked. Appears whenever a button is currently unusable.
        </p>
        
        <h2>
            Credits
        </h2>

        <p>
            - Game Creator: SuperBro64 (Brandon Jackson)
            <br><br>
            - Background Music: Super Monkey Ball 2
            <a href = "https://downloads.khinsider.com/game-soundtracks/album/super-monkey-ball-2">Source</a>
            <br><br>
            - Sound Effects: Super Mario 64
            <a href = "https://themushroomkingdom.net/media/sm64/wav">Source</a>
            <br><br>
            - Font: New Super Mario Bros. U
            <a href = "https://fontmeme.com/fonts/new-super-mario-font-u-font">Source</a>
            <br><br>
            - Joystick Code: Bobboteck (Roberto D'Amico)
            <a href = "https://github.com/bobboteck/JoyStick">Source</a>
            <br><br>
            <a href = "https://superbro64.github.io">Back to Homepage</a>
        </p>

    </body>
</html>
